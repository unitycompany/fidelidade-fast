<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Notifica√ß√µes - Fast Fidelidade</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px;
            transition: transform 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #cce7ff; color: #004085; border: 1px solid #b8daff; }
        .instructions {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîî Teste de Notifica√ß√µes PWA</h1>
        
        <div class="instructions">
            <h3>üìã Instru√ß√µes:</h3>
            <ol>
                <li><strong>Primeiro:</strong> Clique em "Solicitar Permiss√£o" e aceite as notifica√ß√µes</li>
                <li><strong>Depois:</strong> Teste os diferentes tipos de notifica√ß√£o</li>
                <li><strong>Importante:</strong> As notifica√ß√µes aparecem mesmo quando a aba n√£o est√° ativa</li>
            </ol>
        </div>

        <div id="status"></div>

        <h3>üéØ Testes Dispon√≠veis:</h3>

        <button onclick="requestPermission()">
            üîî Solicitar Permiss√£o de Notifica√ß√µes
        </button>

        <button onclick="testBasicNotification()" id="testBasic" disabled>
            üß™ Testar Notifica√ß√£o B√°sica
        </button>

        <button onclick="testPointsNotification()" id="testPoints" disabled>
            ‚≠ê Simular Pontos Creditados (150 pts)
        </button>

        <button onclick="testPrizeNotification()" id="testPrize" disabled>
            üéâ Simular Pr√™mio Resgatado
        </button>

        <button onclick="testInactivityNotification()" id="testInactivity" disabled>
            üõí Simular Notifica√ß√£o de Inatividade
        </button>

        <h3>üìä Status das Notifica√ß√µes:</h3>
        <div id="notificationStatus">Carregando...</div>
    </div>

    <script>
        // Registrar Service Worker primeiro
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js')
                .then(registration => {
                    console.log('Service Worker registrado:', registration);
                })
                .catch(error => {
                    console.error('Erro ao registrar Service Worker:', error);
                });
        }

        function updateStatus(message, type = 'info') {
            const status = document.getElementById('status');
            status.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function updateNotificationStatus() {
            const statusDiv = document.getElementById('notificationStatus');
            const permission = Notification.permission;
            const hasServiceWorker = 'serviceWorker' in navigator;
            const hasNotifications = 'Notification' in window;

            let status = `
                <div class="status ${permission === 'granted' ? 'success' : permission === 'denied' ? 'error' : 'info'}">
                    <strong>Permiss√£o:</strong> ${permission === 'granted' ? '‚úÖ Concedida' : permission === 'denied' ? '‚ùå Negada' : '‚è≥ N√£o solicitada'}
                </div>
                <div class="status ${hasServiceWorker ? 'success' : 'error'}">
                    <strong>Service Worker:</strong> ${hasServiceWorker ? '‚úÖ Suportado' : '‚ùå N√£o suportado'}
                </div>
                <div class="status ${hasNotifications ? 'success' : 'error'}">
                    <strong>Notifications API:</strong> ${hasNotifications ? '‚úÖ Suportado' : '‚ùå N√£o suportado'}
                </div>
            `;

            statusDiv.innerHTML = status;

            // Habilitar/desabilitar bot√µes
            const buttonsToToggle = ['testBasic', 'testPoints', 'testPrize', 'testInactivity'];
            buttonsToToggle.forEach(id => {
                document.getElementById(id).disabled = permission !== 'granted';
            });
        }

        async function requestPermission() {
            try {
                const permission = await Notification.requestPermission();
                updateStatus(
                    permission === 'granted' ? 
                    '‚úÖ Permiss√£o concedida! Agora voc√™ pode testar as notifica√ß√µes.' : 
                    '‚ùå Permiss√£o negada. N√£o ser√° poss√≠vel receber notifica√ß√µes.',
                    permission === 'granted' ? 'success' : 'error'
                );
                updateNotificationStatus();
            } catch (error) {
                updateStatus('‚ùå Erro ao solicitar permiss√£o: ' + error.message, 'error');
            }
        }

        async function sendNotification(title, body, tag = 'test') {
            if (Notification.permission !== 'granted') {
                updateStatus('‚ùå Permiss√£o de notifica√ß√µes n√£o concedida!', 'error');
                return;
            }

            const options = {
                body,
                icon: '/icon-192x192.png',
                badge: '/icon-192x192.png',
                vibrate: [200, 100, 200],
                tag,
                requireInteraction: false,
                actions: [
                    { action: 'view', title: 'Ver no app' },
                    { action: 'close', title: 'Fechar' }
                ]
            };

            try {
                if ('serviceWorker' in navigator) {
                    const registration = await navigator.serviceWorker.ready;
                    await registration.showNotification(title, options);
                    updateStatus('‚úÖ Notifica√ß√£o enviada via Service Worker!', 'success');
                } else {
                    new Notification(title, options);
                    updateStatus('‚úÖ Notifica√ß√£o enviada!', 'success');
                }
            } catch (error) {
                updateStatus('‚ùå Erro ao enviar notifica√ß√£o: ' + error.message, 'error');
            }
        }

        function testBasicNotification() {
            sendNotification(
                'Notifica√ß√£o de Teste üß™',
                'Se voc√™ est√° vendo isto, as notifica√ß√µes est√£o funcionando perfeitamente!'
            );
        }

        function testPointsNotification() {
            sendNotification(
                'Pontos creditados! ‚≠ê',
                'Voc√™ ganhou 150 pontos! Continue comprando na Fast para acumular mais.',
                'points'
            );
        }

        function testPrizeNotification() {
            sendNotification(
                'Parab√©ns! Pr√™mio resgatado! üéâ',
                'Dirija-se at√© uma loja Fast para retirar seu pr√™mio.',
                'prize'
            );
        }

        function testInactivityNotification() {
            sendNotification(
                'Ei! Compre na Fast e ganhe pontos! üõí',
                'Faz tempo que voc√™ n√£o cadastra uma nota fiscal. Que tal acumular alguns pontos?',
                'inactivity'
            );
        }

        // Inicializar status ao carregar
        updateNotificationStatus();

        // Atualizar status quando a permiss√£o mudar
        setInterval(updateNotificationStatus, 2000);
    </script>
</body>
</html>
